{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "SAD",
	"scopeName": "source.sad",
	"patterns": [
	  { "include": "#comments" },
	  { "include": "#numbers" },
	  { "include": "#particles" },
	  { "include": "#types" },
	  { "include": "#operators" },
	  { "include": "#controls" },
	  { "include": "#keywords" },
	  { "include": "#functions" },
	  { "include": "#objects" },
	  { "include": "#internals" },
	  { "include": "#math" },
	  { "include": "#macros" },
	  { "include": "#strings" },
	  { "include": "#block" }
	],
	// command sytax rule copied from madx
	"repository": {
	  "attributes": {
		"patterns": [
		  { "include" : "#attributes-stringval" },
		  { "include" : "#attributes-singular" },
		  { "include" : "#attributes-default" }
		]
	  },
	  "attributes-stringval": {
		"patterns": [
		  {
			//"match": "(?xi)\\b(clist|file|format|halofile|mlist|sectorfile|offsetelem|trueprofile)\\s*(=)\\s*(.+?)\\s*(?=[,;\\s])",
			"match": "(?xi)\\b(hoge)\\s*(=)\\s*(.+?)\\s*(?=[,;\\s])",
			"captures": {
			  "1": {"name": "variable.other.attribute.sad"},
			  "2": {"name": "punctuation.sad"},
			  "3": {"name": "string.unquoted.format.sad"}
			}
		  }
		]
	  },
	  "attributes-singular": {
		"patterns": [
		  {
			//"match": "(?xi)\\b(?<!\\.)(bborbit|bunched|cavall|chrom|clear|debug|echo|echomacro|full|info|no_fatal_stop|radiate|rbarc|reset|rmatrix|sympl|tell|thick|thin_foc|threader|trace|truncate|twiss_print|verbose|verify|warn)\\b",
			"match": "(?xi)\\b(?<!\\.)(moge)\\b",
			"name": "variable.other.attribute.sad"
		  }
		]
	  },
	  "attributes-default": {
		"patterns": [
		  {
			"match": "(?xi)\\b([a-zA-Z]?[a-zA-Z0-9_]*)\\s*(=)",
			"captures": {
			  "1": {"name": "variable.other.attribute.sad"},
			  "2": {"name": "punctuation.sad"}
			}
		  }
		]
	  },
	  "functions": {
		"patterns": [
		  {
			"begin": "(?xi)\\b(?<!\\.)(table|tabindex|tabstring|gettab|getidx)(\\s*\\()",
			"beginCaptures": {
			  "1": {"name": "support.function.sad"},
			  "2": {"name": "punctuation.sad"}
			},
			"patterns": [
			  { "include": "#innards" }
			],
			"end": "\\)",
			"endCaptures": {
			  "0": {"name": "punctuation.sad"}
			}
		  }
		]
	  },
	  "innards": {
		"patterns": [
		  { "include": "#numbers" },
		  { "include": "#operators" },
		  { "include": "#keywords" },
		  { "include": "#objects" },
		  { "include": "#internals" },
		  { "include": "#math" },
		  { "include": "#strings" }
		]
	  },
	  "macros": {
		"patterns": [
		  { "include": "#macrodef-input" },
		  { "include": "#macrodef-noinput" }
		]
	  },
	  "macrodef-input": {
		"patterns": [
		  {
			"begin": "(?xi)\\b([a-zA-Z_][a-zA-Z0-9_]*)(\\s*\\()(?=.*\\)\\s*:\\s*macro)",
			"beginCaptures": {
			  "1": {"name": "entity.name.function.macro.input.sad"},
			  "2": {"name": "punctuation.sad"}
			},
			"end": "\\)",
			"endCaptures": {
			  "0": {"name": "punctuation.sad"}
			},
			"patterns": [
			  { "include": "#internals" },
			  { "include": "#numbers" },
			  { "include": "#strings" }
			]
		  }
		]
	  },
	  "macrodef-noinput": {
		"patterns": [
		  {
			"match": "(?xi)\\b([a-zA-Z]?[a-zA-Z0-9_]*)\\s*(:)\\s*(?=macro)",
			"captures": {
			  "1": {"name": "entity.name.function.macro.noinput.sad"},
			  "2": {"name": "punctuation.sad"}
			}
		  }
		]
	  },
	  "objects": {
		"patterns": [
		  {
			"match": "(?xi)\\b(?<!\\.)(beam)(?=%|->)\\b",
			"name": "support.class.sad"
		  }
		]
	  },
	  "internals": {
		"patterns": [
		  {
			// 2022/02/12 edit	
			"match": "(?xi)\\b(?<!\\.)(pi|True|False|Infinity|INF|NaN|E|I|Degree|GoldenRatio|EulerGamma)(?!\\.)\\b",
			"name": "constant.language.sad"
		  },
		  {
			//"match": "(?xi)\\b(?<!\\.)(aperture|twiss|beam|summ)\\b",
			"match": "(?xi)\\b(?<!\\.)(aperture|twiss|beam|summ)\\b",
			"name": "variable.language.internal.sad"
		  }
		]
	  },
	  "keywords": {
		"patterns": [
		  {
			//"match": "(?i)\\b(?<!\\.)(if|elseif|else|while)\\b",
			"match": "(?i)\\b(?<!\\.)(If|ELSEIF|ELSE|While|Do)\\b",
			"name": "keyword.control.conditional.sad"
		  },
		//   {
		// 	"match": "(?i)\\b(?<!\\.)(macro)(?=\\s*=)\\b",
		// 	"name": "keyword.control.macro.sad"
		//   },
		  {
			// "match": "(?i)\\b(?<!\\.)(clear|endedit|endmatch|exit|flatten|quit|reflect|stop|survey|twiss)\\b",
			"match": "(?i)\\b(?<!\\.)(end|abort|)\\b",
			"name": "keyword.control.command.sad"
		  }
		]
	  },
	  "controls": {
		"patterns": [
		  {
			"begin": "(?xi)\\b(?<!\\.)(exec)(\\s*[\\,\\s])([a-zA-Z]?[a-zA-Z0-9_]*)(\\s*\\()",
			"beginCaptures": {
			  "1": {"name": "keyword.control.sad"},
			  "2": {"name": "punctuation.sad"},
			  "3": {"name": "entity.name.function.macro.input.sad"},
			  "4": {"name": "punctuation.sad"}
			},
			"end": "\\)\\s*;",
			"endCaptures": {
			  "0": {"name": "punctuation.sad"}
			},
			"patterns": [
			  { "include": "#internals" },
			  { "include": "#functions" },
			  { "include": "#objects" },
			  { "include": "#math" },
			  { "include": "#particles" },
			  { "include": "#numbers" },
			  { "include": "#strings" }
			]
		  },
		  {
			"begin": "(?xi)\\b(?<!\\.)(aperture|assign|beam|call|coguess|constraint|copyfile|clear|create|cycle|delete|dumpsequ|emit|exec|extract|fill|fill_knob|global|gweight|help|install|jacobian|lmdif|makethin|match|migrad|move|option|plot|print|printf|readmytable|readtable|remove|removefile|renamefile|replace|resbeam|resplot|save|savebeta|select|set|setvars|setvars_const|setvars_knob|setvars_lin|seqedit|show|shrink|simplex|sixtrack|sxfread|sxfwrite|survey|system|title|twiss|use|use_macro|write|value|vary|weight)(\\s*[\\,\\s])",
			"beginCaptures": {
			  "1": {"name": "keyword.control.sad"},
			  "2": {"name": "punctuation.sad"}
			},
			"end": ";",
			"endCaptures": {
			  "0": {"name": "punctuation.sad"}
			},
			"patterns": [
			  { "include": "#attributes" },
			  { "include": "#flags" },
			  { "include": "#internals" },
			  { "include": "#functions" },
			  { "include": "#objects" },
			  { "include": "#math" },
			  { "include": "#particles" },
			  { "include": "#numbers" },
			  { "include": "#strings" }
			]
		  }
		]
	  },
	  "flags": {
		"patterns": [
		  {
			"match": "(?xi)\\b(?<!\\.)(error|makethin|save|sectormap|seqedit)\\b",
			"name": "constant.flag.sad"
		  }
		]
	  },
	  "particles": {
		"patterns": [
		  {
			"match": "(?xi)\\b(?<!\\.)(positron|electron|proton|antiproton|posmuon|negmuon|ion)\\b",
			"name": "constant.numeric.particle.sad"
		  }
		]
	  },
	  "math": {
		"patterns": [
		  {
			"match": "(?xi)\\b(?<!\\.)(sqrt|log|log10|exp|sin|cos|tan|asin|acos|atan|sinh|cosh|tanh|sinc|abs|erf|erfc|floor|ceil|round|frac|ranf|gauss|tgauss)\\b",
			"name": "support.function.sad"
		  }
		]
	  },
	  "strings": {
		"patterns": [
		  {
			"name": "string.quoted.double.sad",
			"begin": "\"",
			"end": "\"",
			"patterns": [
			  {
				"name": "constant.character.escape.sad",
				"match": "\\\\."
			  }
			]
		  }
		]
	  },
	  "numbers": {
		"patterns": [
		  {
			"match": "\\b(?<!\\.)([0-9]+\\.{1}[0-9]*)([eEdD]{1}[\\-|\\+]?[0-9]+)?\\b",
			"captures": {
			  "1": {"name": "constant.numeric.float.sad"},
			  "2": {"name": "constant.numeric.exponential.sad"}
			}
		  },
		  {
			"match": "\\b(?<!\\.)([0-9]+)([eEdD]{1}[\\-|\\+]?[0-9]+)?\\b",
			"captures": {
			  "1": {"name": "constant.numeric.integer.sad"},
			  "2": {"name": "constant.numeric.exponential.sad"}
			}
		  },
		  {
			"match": "\\b(?<!\\.)(true|false)\\b",
			"captures": {
			  "1": {"name": "constant.numeric.boolean.sad"}
			}
		  }
		]
	  },
	  "comments": {
		"patterns": [
		  {
			"begin": "!",
			"end": "\n",
			"name": "comment.line.sad"
		  },
		  {
			"begin": "!",
			"end": "\n\r",
			"name": "comment.line.sad"
		  }
		]
	  },
	  "types": {
		"patterns": [
		  {
			"match": "(?i)\\b(?<!\\.)(const)\\b",
			"name": "storage.modifier.sad"
		  },
		  {
			"match": "(?i)\\b(?<!\\.)(real|int)\\b",
			"name": "storage.type.sad"
		  }
		]
	  },
	  "operators": {
		"patterns": [
		  {
			"match": "==|<>|<|>|<=|=>",
			"name": "keyword.operator.comparison.sad"
		  }
		]
	  }
	}
  }